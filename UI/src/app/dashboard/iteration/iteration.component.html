<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  Copyright 2014 CapitalOne, LLC.
  Further development Copyright 2022 Sapient Corporation.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<p-toast [style]="{marginTop: '80px'}"></p-toast>
<div *ngIf="!noKpis else noKpiTemplate">
  <div id="message"></div>
  <ng-container *ngIf="!noProjects else noProjectsTemplate">
    <ng-container *ngIf="!noSprints else noSprintsTemplate">
      <div class="{{selectedtype}}" id="{{selectedtype}}">
        <div class="clearfix">
          <div class="right-container col">
            <p-tabView class="iteration-tabs" [(activeIndex)]="activeIndex" (onChange)="handleTabChange($event)">
              <p-tabPanel *ngFor="let board of navigationTabs" [header]="board.label" [disabled]="board.count == 0">
                <ng-container *ngIf="(updatedConfigGlobalData | json) !== '{}' && updatedConfigGlobalData != undefined && activeIndex!==2">
                  <div class="p-grid p-pr-2 p-pl-2 iteration-dashboard">
                    <ng-container *ngIf="board.width === 'half'">

                      <!-- full width kpi render start -->
                      <div class="subKPi p-sm-12" cdkDropList (cdkDropListDropped)="drop($event,board)" [cdkDropListData]="board.fullWidthKpis">
                        <ng-container *ngFor="let kpi of board.fullWidthKpis">
                          <div class="card-type-1 p-pl-0" *ngIf="kpi?.kpiDetail?.boxType !== 'chart' ;else chart">
                            <app-kpi-card [trendBoxColorObj]="trendBoxColorObj" [kpiData]="kpi"
                              (downloadExcel)="downloadExcel(kpi.kpiId, kpi.kpiName, kpi.kpiDetail.kanban)"
                              [dropdownArr]="kpiDropdowns[kpi?.kpiId]" (optionSelected)="handleSelectedOption($event, kpi)"
                              [showExport]="false" [isShow]="true" [showChartView]="kpi?.kpiDetail?.boxType == 'chart'"
                              [showCommentIcon]="true" [commentCount]="kpiCommentsCountObj[kpi?.kpiId]"
                              (getCommentCountByKpi)="getKpiCommentsCount($event)" (reloadKPITab)="reloadKPI($event)">
                              <ng-container *ngIf="!noTabAccess else noDataAccess">
                                <div *ngIf="ifKpiExist(kpi.kpiId) != -1; else loader">
                                <div class="p-d-flex p-justify-around p-align-center w-100"
                                  *ngIf="(kpiChartData | json) !== '{}' && kpiChartData != undefined && kpiChartData[kpi?.kpiId]?.length > 0;else noData">
                                  <ng-container *ngFor="let item of kpiChartData[kpi?.kpiId]; let index=index">
                                    <div *ngFor="let x of item.data; let i = index" class="p-3 p-text-center"
                                      [ngClass]="{'wrapper-w-50' : true ,'kpi-content-container': item.data.length ==2 && i!==1 }">
                                      <div class="p-d-flex p-flex-column p-justify-center kpi-sub-headings">
                                        <h3 class="text-label">{{x?.label}}
                                          <img *ngIf="x?.hasOwnProperty('modalValues') && x?.modalValues?.length > 0"
                                            src="../../../assets/img/arrow-down.svg" alt="arrow-down" class="btn-arrow-down"
                                            (click)="handleArrowClick(kpi, x?.label, x?.modalValues)" />
                                        </h3>
                                        <p *ngIf="x?.labelInfo" class="p-m-0">{{x?.labelInfo}}</p>
                                      </div>
                                      <p class="text-data">
                                        <span
                                          [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk'}">{{x?.value
                                          != -99 ?
                                          convertToHoursIfTime(x?.value,x?.unit) : '-'}}</span>
                                        <span
                                          [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit == '%'}"
                                          *ngIf="x?.value != -99 && x?.unit && x?.unit?.toLowerCase() !== 'hours' && x?.unit?.toLowerCase() !== 'day'">
                                          {{ x?.value != -99 ? x?.unit: ''}}
                                        </span>
                                        <span *ngIf="(x?.value1 !== '') && x?.value1 != -99 && x?.value1 != undefined"
                                          [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'}">{{'/' +
                                          (((x?.value1 >= 0 || x?.value1 < 0) && x?.unit1) ? convertToHoursIfTime(x?.value1,x?.unit1) :
                                            x?.value1)}}</span>
                                            <span
                                              [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'
                                                                || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit1 == '%'}"
                                              *ngIf="x?.value1 != -99 && x?.unit1 && x?.unit1?.toLowerCase() !== 'hours' && x?.unit1?.toLowerCase() !== 'day'">
                                              {{ x?.value1 != -99 ? x?.unit1 : ''}}
                                            </span>
                                      </p>
                                    </div>
                                  </ng-container>
                                </div>
                              </div>
                              </ng-container>
                            </app-kpi-card>
                          </div>
                          <ng-template #noData>
                            <div class="overlay" *ngIf="(kpiChartData[kpi.kpiId] && kpiChartData[kpi.kpiId]?.length)|| kpiLoader">
                              <div class="loading-img"></div>
                            </div>
                            <div class="min-ht"
                              *ngIf="kpiChartData[kpi.kpiId] &&  kpiChartData[kpi.kpiId]?.length === 0 && kpiLoader === false">
                              <div class="err">No Data Available</div>
                            </div>
                          </ng-template>
                          <ng-template #loader>
                            <div class="overlay">
                              <div class="loading-img"></div>
                            </div>
                          </ng-template>
                        </ng-container>
                      </div>
                      <!-- full width kpi render end -->
                      <!-- kpi part 1 render start -->
                      <div class="subKPi p-sm-6 p-pt-0" cdkDropList (cdkDropListDropped)="drop($event,board)" [cdkDropListData]="board.kpiPart1">
                        <ng-container *ngFor="let kpi of board.kpiPart1">
                          <div class="p-pt-3 p-h-fit-content" cdkDrag [cdkDragData]="kpi">
                            <!-- card container -->
                            <div class="card-type-1 p-pl-0" *ngIf="kpi?.kpiDetail?.boxType !== 'chart' ;else chart">
                              <app-kpi-card [trendBoxColorObj]="trendBoxColorObj" [kpiData]="kpi"
                                (downloadExcel)="downloadExcel(kpi.kpiId, kpi.kpiName, kpi.kpiDetail.kanban)"
                                [dropdownArr]="kpiDropdowns[kpi?.kpiId]" (optionSelected)="handleSelectedOption($event, kpi)"
                                [showExport]="false" [isShow]="true" [showChartView]="kpi?.kpiDetail?.boxType == 'chart'"
                                [showCommentIcon]="true" [commentCount]="kpiCommentsCountObj[kpi?.kpiId]"
                                (getCommentCountByKpi)="getKpiCommentsCount($event)" (reloadKPITab)="reloadKPI($event)">
                                <ng-container *ngIf="!noTabAccess else noDataAccess">
                                  <div *ngIf="ifKpiExist(kpi.kpiId) != -1; else loader">
                                  <div class="p-d-flex p-justify-around p-align-center w-100"
                                    *ngIf="(kpiChartData | json) !== '{}' && kpiChartData != undefined && kpiChartData[kpi?.kpiId]?.length > 0;else noData">
                                    <ng-container *ngFor="let item of kpiChartData[kpi?.kpiId]; let index=index">
                                      <div *ngFor="let x of item.data; let i = index" class="p-3 p-text-center"
                                        [ngClass]="{'wrapper-w-50' : true ,'kpi-content-container': item.data.length ==2 && i!==1 }">
                                        <div class="p-d-flex p-flex-column p-justify-center kpi-sub-headings">
                                          <h3 class="text-label">{{x?.label}}
                                            <img *ngIf="x?.hasOwnProperty('modalValues') && x?.modalValues?.length > 0"
                                              src="../../../assets/img/arrow-down.svg" alt="arrow-down" class="btn-arrow-down"
                                              (click)="handleArrowClick(kpi, x?.label, x?.modalValues)" />
                                          </h3>
                                          <p *ngIf="x?.labelInfo" class="p-m-0">{{x?.labelInfo}}</p>
                                        </div>
                                        <p class="text-data">
                                          <span
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk'}">{{x?.value
                                            != -99 ?
                                            convertToHoursIfTime(x?.value,x?.unit) : '-'}}</span>
                                          <span
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit == '%'}"
                                            *ngIf="x?.value != -99 && x?.unit && x?.unit?.toLowerCase() !== 'hours' && x?.unit?.toLowerCase() !== 'day'">
                                            {{ x?.value != -99 ? x?.unit: ''}}
                                          </span>
                                          <span *ngIf="(x?.value1 !== '') && x?.value1 != -99 && x?.value1 != undefined"
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'}">{{'/' +
                                            (((x?.value1 >= 0 || x?.value1 < 0) && x?.unit1) ? convertToHoursIfTime(x?.value1,x?.unit1) :
                                              x?.value1)}}</span>
                                              <span
                                                [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'
                                                                  || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit1 == '%'}"
                                                *ngIf="x?.value1 != -99 && x?.unit1 && x?.unit1?.toLowerCase() !== 'hours' && x?.unit1?.toLowerCase() !== 'day'">
                                                {{ x?.value1 != -99 ? x?.unit1 : ''}}
                                              </span>
                                        </p>
                                      </div>
                                    </ng-container>
                                  </div>
                                  </div>
                                </ng-container>
                              </app-kpi-card>
                            </div>

                            <!--chart container-->
                            <ng-template #chart>
                              <div class="p-sm-12 p-pl-0 p-pr-0 iteration-chart p-pt-0 p-pb-0">
                                <app-kpi-card [trendBoxColorObj]="trendBoxColorObj" [kpiData]="kpi"
                                  (downloadExcel)="downloadExcel(kpi.kpiId, kpi.kpiName, kpi.kpiDetail.kanban,kpi?.kpiDetail?.additionalFilterSupport)"
                                  [dropdownArr]="kpiDropdowns[kpi?.kpiId]" (optionSelected)="handleSelectedOption($event, kpi)"
                                  [showExport]="kpi.kpiId !== 'kpi125' ? true : false" [isShow]="true"
                                  [showChartView]="kpi?.kpiDetail?.boxType == 'chart' && !(kpiChartData[kpi.kpiId] &&  kpiChartData[kpi.kpiId]?.length === 0 && kpiLoader === false)"
                                  [showCommentIcon]="true" [commentCount]="kpiCommentsCountObj[kpi?.kpiId]"
                                  (getCommentCountByKpi)="getKpiCommentsCount($event)" (reloadKPITab)="reloadKPI($event)">
                                  <ng-container *ngIf="!noTabAccess else noDataAccess">
                                    <ng-container *ngIf="(kpiChartData | json) !== '{}' && kpiChartData != undefined;else noData">
                                      <div class="p-pl-3 p-pr-3 w-100 position-relative" [ngSwitch]="kpi?.kpiDetail?.chartType"
                                        *ngIf="ifKpiExist(kpi.kpiId) != -1; else loader">
                                        <ng-container *ngIf="kpiChartData[kpi?.kpiId]?.length > 0   ; else noData">
                                          <app-groupstackchart *ngSwitchCase="'stackedColumn'" [xCaption]="kpi?.kpiDetail?.xaxisLabel"
                                            [yCaption]="kpi?.kpiDetail?.yaxisLabel" [unit]="kpi?.kpiDetail?.kpiUnit"
                                            [thresholdValue]="kpiThresholdObj[kpi?.kpiId]" [data]="kpiChartData[kpi?.kpiId]"
                                            [color]="chartColorList" [selectedtype]="selectedtype" [kpiId]="kpi?.kpiId"
                                            [legendType]="'normal'">
                                          </app-groupstackchart>
                                          <app-group-bar-chart *ngSwitchCase="'GroupBarChart'" [xCaption]="kpi?.kpiDetail?.xaxisLabel"
                                            [yCaption]="kpi?.kpiDetail?.yaxisLabel" [unit]="kpi?.kpiDetail?.kpiUnit"
                                            [thresholdValue]="kpiThresholdObj[kpi?.kpiId]" [data]="kpiChartData[kpi?.kpiId]"
                                            [color]="chartColorList" [selectedtype]="selectedtype" [kpiId]="kpi?.kpiId"
                                            [legendType]="'normal'">
                                          </app-group-bar-chart>

                                          <app-cumulative-line-chart *ngSwitchCase="'CumulativeMultilineChart'" [kpiId]="kpi.kpiId"
                                            [xCaption]="kpi?.kpiDetail?.xaxisLabel" [yCaption]="kpi?.kpiDetail?.yaxisLabel"
                                            [data]="kpiChartData[kpi?.kpiId]">
                                          </app-cumulative-line-chart>


                                          <app-piechart *ngSwitchCase="'pieChart'" [data]="kpiChartData[kpi?.kpiId]"></app-piechart>
                                          <app-multiline *ngSwitchDefault [thresholdValue]="kpiThresholdObj[kpi?.kpiId]"
                                            [unit]="kpi?.kpiDetail?.kpiUnit" [data]="kpiChartData[kpi?.kpiId]"
                                            [xCaption]="kpi?.kpiDetail?.xaxisLabel" [yCaption]="kpi?.kpiDetail?.yaxisLabel"
                                            [name]="kpi?.kpiName" [kpiId]="kpi?.kpiId" [color]="chartColorList[kpi?.kpiId]"
                                            [selectedtype]="selectedtype">
                                          </app-multiline>
                                        </ng-container>
                                      </div>
                                    </ng-container>

                                  </ng-container>
                                </app-kpi-card>
                              </div>
                            </ng-template>
                          </div>
                          <ng-template #noData>
                            <div class="overlay" *ngIf="(kpiChartData[kpi.kpiId] && kpiChartData[kpi.kpiId]?.length)|| kpiLoader">
                              <div class="loading-img"></div>
                            </div>
                            <div class="min-ht"
                              *ngIf="kpiChartData[kpi.kpiId] &&  kpiChartData[kpi.kpiId]?.length === 0 && kpiLoader === false">
                              <div class="err">No Data Available</div>
                            </div>
                          </ng-template>
                          <ng-template #loader>
                            <div class="overlay">
                              <div class="loading-img"></div>
                            </div>
                          </ng-template>
                        </ng-container>
                      </div>
                      <!-- kpi part 1 render end -->
                       <!-- kpi part 2 render start -->
                       <div class="subKPi p-sm-6 p-pt-0" cdkDropList (cdkDropListDropped)="drop($event,board)" [cdkDropListData]="board.kpiPart2">
                        <ng-container *ngFor="let kpi of board.kpiPart2">
                          <div class="p-pt-3 p-h-fit-content" cdkDrag [cdkDragData]="kpi">
                            <!-- card container -->
                            <div class="card-type-1 p-pl-0" *ngIf="kpi?.kpiDetail?.boxType !== 'chart' ;else chart">
                              <app-kpi-card [trendBoxColorObj]="trendBoxColorObj" [kpiData]="kpi"
                                (downloadExcel)="downloadExcel(kpi.kpiId, kpi.kpiName, kpi.kpiDetail.kanban)"
                                [dropdownArr]="kpiDropdowns[kpi?.kpiId]" (optionSelected)="handleSelectedOption($event, kpi)"
                                [showExport]="false" [isShow]="true" [showChartView]="kpi?.kpiDetail?.boxType == 'chart'"
                                [showCommentIcon]="true" [commentCount]="kpiCommentsCountObj[kpi?.kpiId]"
                                (getCommentCountByKpi)="getKpiCommentsCount($event)" (reloadKPITab)="reloadKPI($event)">
                                <ng-container *ngIf="!noTabAccess else noDataAccess">
                                  <div *ngIf="ifKpiExist(kpi.kpiId) != -1; else loader">
                                  <div class="p-d-flex p-justify-around p-align-center w-100"
                                    *ngIf="(kpiChartData | json) !== '{}' && kpiChartData != undefined && kpiChartData[kpi?.kpiId]?.length > 0;else noData">
                                    <ng-container *ngFor="let item of kpiChartData[kpi?.kpiId]; let index=index">
                                      <div *ngFor="let x of item.data; let i = index" class="p-3 p-text-center"
                                        [ngClass]="{'wrapper-w-50' : true ,'kpi-content-container': item.data.length ==2 && i!==1 }">
                                        <div class="p-d-flex p-flex-column p-justify-center kpi-sub-headings">
                                          <h3 class="text-label">{{x?.label}}
                                            <img *ngIf="x?.hasOwnProperty('modalValues') && x?.modalValues?.length > 0"
                                              src="../../../assets/img/arrow-down.svg" alt="arrow-down" class="btn-arrow-down"
                                              (click)="handleArrowClick(kpi, x?.label, x?.modalValues)" />
                                          </h3>
                                          <p *ngIf="x?.labelInfo" class="p-m-0">{{x?.labelInfo}}</p>
                                        </div>
                                        <p class="text-data">
                                          <span
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk'}">{{x?.value
                                            != -99 ?
                                            convertToHoursIfTime(x?.value,x?.unit) : '-'}}</span>
                                          <span
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit == '%'}"
                                            *ngIf="x?.value != -99 && x?.unit && x?.unit?.toLowerCase() !== 'hours' && x?.unit?.toLowerCase() !== 'day'">
                                            {{ x?.value != -99 ? x?.unit: ''}}
                                          </span>
                                          <span *ngIf="(x?.value1 !== '') && x?.value1 != -99 && x?.value1 != undefined"
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'}">{{'/' +
                                            (((x?.value1 >= 0 || x?.value1 < 0) && x?.unit1) ? convertToHoursIfTime(x?.value1,x?.unit1) :
                                              x?.value1)}}</span>
                                              <span
                                                [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'
                                                                  || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit1 == '%'}"
                                                *ngIf="x?.value1 != -99 && x?.unit1 && x?.unit1?.toLowerCase() !== 'hours' && x?.unit1?.toLowerCase() !== 'day'">
                                                {{ x?.value1 != -99 ? x?.unit1 : ''}}
                                              </span>
                                        </p>
                                      </div>
                                    </ng-container>
                                  </div>
                                  </div>
                                </ng-container>
                              </app-kpi-card>
                            </div>

                            <!--chart container-->
                            <ng-template #chart>
                              <div class="p-sm-12 p-pl-0 p-pr-0 iteration-chart p-pt-0 p-pb-0">
                                <app-kpi-card [trendBoxColorObj]="trendBoxColorObj" [kpiData]="kpi"
                                  (downloadExcel)="downloadExcel(kpi.kpiId, kpi.kpiName, kpi.kpiDetail.kanban,kpi?.kpiDetail?.additionalFilterSupport)"
                                  [dropdownArr]="kpiDropdowns[kpi?.kpiId]" (optionSelected)="handleSelectedOption($event, kpi)"
                                  [showExport]="kpi.kpiId !== 'kpi125' ? true : false" [isShow]="true"
                                  [showChartView]="kpi?.kpiDetail?.boxType == 'chart' && !(kpiChartData[kpi.kpiId] &&  kpiChartData[kpi.kpiId]?.length === 0 && kpiLoader === false)"
                                  [showCommentIcon]="true" [commentCount]="kpiCommentsCountObj[kpi?.kpiId]"
                                  (getCommentCountByKpi)="getKpiCommentsCount($event)" (reloadKPITab)="reloadKPI($event)">
                                  <ng-container *ngIf="!noTabAccess else noDataAccess">
                                    <ng-container *ngIf="(kpiChartData | json) !== '{}' && kpiChartData != undefined;else noData">
                                      <div class="p-pl-3 p-pr-3 w-100 position-relative" [ngSwitch]="kpi?.kpiDetail?.chartType"
                                        *ngIf="ifKpiExist(kpi.kpiId) != -1; else loader">
                                        <ng-container *ngIf="kpiChartData[kpi?.kpiId]?.length > 0   ; else noData">
                                          <app-groupstackchart *ngSwitchCase="'stackedColumn'" [xCaption]="kpi?.kpiDetail?.xaxisLabel"
                                            [yCaption]="kpi?.kpiDetail?.yaxisLabel" [unit]="kpi?.kpiDetail?.kpiUnit"
                                            [thresholdValue]="kpiThresholdObj[kpi?.kpiId]" [data]="kpiChartData[kpi?.kpiId]"
                                            [color]="chartColorList" [selectedtype]="selectedtype" [kpiId]="kpi?.kpiId"
                                            [legendType]="'normal'">
                                          </app-groupstackchart>
                                          <app-group-bar-chart *ngSwitchCase="'GroupBarChart'" [xCaption]="kpi?.kpiDetail?.xaxisLabel"
                                            [yCaption]="kpi?.kpiDetail?.yaxisLabel" [unit]="kpi?.kpiDetail?.kpiUnit"
                                            [thresholdValue]="kpiThresholdObj[kpi?.kpiId]" [data]="kpiChartData[kpi?.kpiId]"
                                            [color]="chartColorList" [selectedtype]="selectedtype" [kpiId]="kpi?.kpiId"
                                            [legendType]="'normal'">
                                          </app-group-bar-chart>

                                          <app-cumulative-line-chart *ngSwitchCase="'CumulativeMultilineChart'" [kpiId]="kpi.kpiId"
                                            [xCaption]="kpi?.kpiDetail?.xaxisLabel" [yCaption]="kpi?.kpiDetail?.yaxisLabel"
                                            [data]="kpiChartData[kpi?.kpiId]">
                                          </app-cumulative-line-chart>


                                          <app-piechart *ngSwitchCase="'pieChart'" [data]="kpiChartData[kpi?.kpiId]"></app-piechart>
                                          <app-multiline *ngSwitchDefault [thresholdValue]="kpiThresholdObj[kpi?.kpiId]"
                                            [unit]="kpi?.kpiDetail?.kpiUnit" [data]="kpiChartData[kpi?.kpiId]"
                                            [xCaption]="kpi?.kpiDetail?.xaxisLabel" [yCaption]="kpi?.kpiDetail?.yaxisLabel"
                                            [name]="kpi?.kpiName" [kpiId]="kpi?.kpiId" [color]="chartColorList[kpi?.kpiId]"
                                            [selectedtype]="selectedtype">
                                          </app-multiline>
                                        </ng-container>
                                      </div>
                                    </ng-container>

                                  </ng-container>
                                </app-kpi-card>
                              </div>
                            </ng-template>
                          </div>
                          <ng-template #noData>
                            <div class="overlay" *ngIf="(kpiChartData[kpi.kpiId] && kpiChartData[kpi.kpiId]?.length)|| kpiLoader">
                              <div class="loading-img"></div>
                            </div>
                            <div class="min-ht"
                              *ngIf="kpiChartData[kpi.kpiId] &&  kpiChartData[kpi.kpiId]?.length === 0 && kpiLoader === false">
                              <div class="err">No Data Available</div>
                            </div>
                          </ng-template>
                          <ng-template #loader>
                            <div class="overlay">
                              <div class="loading-img"></div>
                            </div>
                          </ng-template>
                        </ng-container>
                      </div>
                      <!-- kpi part 2 render end -->
                    </ng-container>

                    <ng-container *ngIf="board.width === 'full'">
                      <div class="subKPi p-sm-12" cdkDropList (cdkDropListDropped)="drop($event,board)" [cdkDropListData]="board.kpis">
                        <ng-container *ngFor="let kpi of board.kpis">
                          <div cdkDrag class="p-sm-12 p-pr-0 p-pl-0 p-h-fit-content" [cdkDragData]="kpi">
                            <!-- card container -->
                            <div class="card-type-1" *ngIf="kpi?.kpiDetail?.boxType !== 'chart' ;else chart">
                              <app-kpi-card [trendBoxColorObj]="trendBoxColorObj" [kpiData]="kpi"
                                (downloadExcel)="downloadExcel(kpi.kpiId, kpi.kpiName, kpi.kpiDetail.kanban)"
                                [dropdownArr]="kpiDropdowns[kpi?.kpiId]" (optionSelected)="handleSelectedOption($event, kpi)"
                                [showExport]="false" [isShow]="true" [showChartView]="kpi?.kpiDetail?.boxType == 'chart'"
                                [showCommentIcon]="true" [commentCount]="kpiCommentsCountObj[kpi?.kpiId]"
                                (getCommentCountByKpi)="getKpiCommentsCount($event)" (reloadKPITab)="reloadKPI($event)">
                                <ng-container *ngIf="!noTabAccess else noDataAccess">
                                  <div class="p-d-flex p-justify-around p-align-center w-100"
                                    *ngIf="(kpiChartData | json) !== '{}' && kpiChartData != undefined && kpiChartData[kpi?.kpiId]?.length > 0;else noData">
                                    <ng-container *ngFor="let item of kpiChartData[kpi?.kpiId]; let index=index">
                                      <div *ngFor="let x of item.data; let i = index" class="p-3 p-text-center"
                                        [ngClass]="{'wrapper-w-50' : true ,'kpi-content-container': item.data.length ==2 && i!==1 }">
                                        <div class="p-d-flex p-flex-column p-justify-center kpi-sub-headings">
                                          <h3 class="text-label">{{x?.label}}
                                            <img *ngIf="x?.hasOwnProperty('modalValues') && x?.modalValues?.length > 0"
                                              src="../../../assets/img/arrow-down.svg" alt="arrow-down" class="btn-arrow-down"
                                              (click)="handleArrowClick(kpi, x?.label, x?.modalValues)" />
                                          </h3>
                                          <p *ngIf="x?.labelInfo" class="p-m-0">{{x?.labelInfo}}</p>
                                        </div>
                                        <p class="text-data">
                                          <span
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk'}">{{x?.value
                                            != -99 ?
                                            convertToHoursIfTime(x?.value,x?.unit) : '-'}}</span>
                                          <span
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added' || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit == '%'}"
                                            *ngIf="x?.value != -99 && x?.unit && x?.unit?.toLowerCase() !== 'hours' && x?.unit?.toLowerCase() !== 'day'">
                                            {{ x?.value != -99 ? x?.unit: ''}}
                                          </span>
                                          <span *ngIf="(x?.value1 !== '') && x?.value1 != -99 && x?.value1 != undefined"
                                            [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'}">{{'/' +
                                            (((x?.value1 >= 0 || x?.value1 < 0) && x?.unit1) ? convertToHoursIfTime(x?.value1,x?.unit1) :
                                              x?.value1)}}</span>
                                              <span
                                                [ngClass]="{'text-red': x?.label?.toLowerCase() === 'scope added'
                                                                  || x?.label?.toLowerCase() === 'issues at risk', 'noSpace':x?.unit1 == '%'}"
                                                *ngIf="x?.value1 != -99 && x?.unit1 && x?.unit1?.toLowerCase() !== 'hours' && x?.unit1?.toLowerCase() !== 'day'">
                                                {{ x?.value1 != -99 ? x?.unit1 : ''}}
                                              </span>
                                        </p>
                                      </div>
                                    </ng-container>
                                  </div>
                                </ng-container>
                              </app-kpi-card>
                            </div>

                            <!--chart container-->
                            <ng-template #chart>
                              <div class="p-sm-12 p-pl-0 p-pr-0 iteration-chart p-pt-0 p-pb-0">
                                <app-kpi-card [trendBoxColorObj]="trendBoxColorObj" [kpiData]="kpi"
                                  (downloadExcel)="downloadExcel(kpi.kpiId, kpi.kpiName, kpi.kpiDetail.kanban,kpi?.kpiDetail?.additionalFilterSupport)"
                                  [dropdownArr]="kpiDropdowns[kpi?.kpiId]" (optionSelected)="handleSelectedOption($event, kpi)"
                                  [showExport]="kpi.kpiId !== 'kpi125' ? true : false" [isShow]="true"
                                  [showChartView]="kpi?.kpiDetail?.boxType == 'chart' && !(kpiChartData[kpi.kpiId] &&  kpiChartData[kpi.kpiId]?.length === 0 && kpiLoader === false)"
                                  [showCommentIcon]="true" [commentCount]="kpiCommentsCountObj[kpi?.kpiId]"
                                  (getCommentCountByKpi)="getKpiCommentsCount($event)" (reloadKPITab)="reloadKPI($event)">
                                  <ng-container *ngIf="!noTabAccess else noDataAccess">
                                    <ng-container *ngIf="(kpiChartData | json) !== '{}' && kpiChartData != undefined;else noData">
                                      <div class="p-pl-3 p-pr-3 w-100 position-relative" [ngSwitch]="kpi?.kpiDetail?.chartType"
                                        *ngIf="ifKpiExist(kpi.kpiId) != -1; else loader">
                                        <ng-container *ngIf="kpiChartData[kpi?.kpiId]?.length > 0   ; else noData">
                                          <app-groupstackchart *ngSwitchCase="'stackedColumn'" [xCaption]="kpi?.kpiDetail?.xaxisLabel"
                                            [yCaption]="kpi?.kpiDetail?.yaxisLabel" [unit]="kpi?.kpiDetail?.kpiUnit"
                                            [thresholdValue]="kpiThresholdObj[kpi?.kpiId]" [data]="kpiChartData[kpi?.kpiId]"
                                            [color]="chartColorList" [selectedtype]="selectedtype" [kpiId]="kpi?.kpiId"
                                            [legendType]="'normal'">
                                          </app-groupstackchart>
                                          <app-group-bar-chart *ngSwitchCase="'GroupBarChart'" [xCaption]="kpi?.kpiDetail?.xaxisLabel"
                                            [yCaption]="kpi?.kpiDetail?.yaxisLabel" [unit]="kpi?.kpiDetail?.kpiUnit"
                                            [thresholdValue]="kpiThresholdObj[kpi?.kpiId]" [data]="kpiChartData[kpi?.kpiId]"
                                            [color]="chartColorList" [selectedtype]="selectedtype" [kpiId]="kpi?.kpiId"
                                            [legendType]="'normal'">
                                          </app-group-bar-chart>

                                          <app-cumulative-line-chart *ngSwitchCase="'CumulativeMultilineChart'" [kpiId]="kpi.kpiId"
                                            [xCaption]="kpi?.kpiDetail?.xaxisLabel" [yCaption]="kpi?.kpiDetail?.yaxisLabel"
                                            [data]="kpiChartData[kpi?.kpiId]">
                                          </app-cumulative-line-chart>


                                          <app-piechart *ngSwitchCase="'pieChart'" [data]="kpiChartData[kpi?.kpiId]"></app-piechart>
                                          <app-multiline *ngSwitchDefault [thresholdValue]="kpiThresholdObj[kpi?.kpiId]"
                                            [unit]="kpi?.kpiDetail?.kpiUnit" [data]="kpiChartData[kpi?.kpiId]"
                                            [xCaption]="kpi?.kpiDetail?.xaxisLabel" [yCaption]="kpi?.kpiDetail?.yaxisLabel"
                                            [name]="kpi?.kpiName" [kpiId]="kpi?.kpiId" [color]="chartColorList[kpi?.kpiId]"
                                            [selectedtype]="selectedtype">
                                          </app-multiline>
                                        </ng-container>
                                      </div>
                                    </ng-container>

                                  </ng-container>
                                </app-kpi-card>
                              </div>
                            </ng-template>
                          </div>
                          <ng-template #noData>
                            <div class="overlay" *ngIf="(kpiChartData[kpi.kpiId] && kpiChartData[kpi.kpiId]?.length)|| kpiLoader">
                              <div class="loading-img"></div>
                            </div>
                            <div class="min-ht"
                              *ngIf="kpiChartData[kpi.kpiId] &&  kpiChartData[kpi.kpiId]?.length === 0 && kpiLoader === false">
                              <div class="err">No Data Available</div>
                            </div>
                          </ng-template>
                          <ng-template #loader>
                            <div class="overlay">
                              <div class="loading-img"></div>
                            </div>
                          </ng-template>
                        </ng-container>
                      </div>
                    </ng-container>


                    <ng-template #noDataAccess>
                      <div class="min-ht">
                        <div class="err"> No Data Available</div>
                      </div>
                    </ng-template>
                  </div>
                </ng-container>
                <ng-container *ngIf="activeIndex === 2">
                  <app-daily-scrum-tab
                    [assigneeList]="kpiChartData['kpi154']"
                    [columns]="jiraKpiData['kpi154']?.modalHeads"
                    [filterData]="jiraKpiData['kpi154']?.filterData"
                    [issueData]="jiraKpiData['kpi154']?.issueData"
                    [standUpStatusFilter]="jiraKpiData['kpi154']?.standUpStatusFilter"
                    [kpiData]="dailyStandupData"
                    (reloadKPITab)="reloadKPI($event)"
                    [loader]=" loaderJiraArray.includes('kpi154')">
                  </app-daily-scrum-tab>
                </ng-container>
              </p-tabPanel>
            </p-tabView>
          </div>
        </div>
      </div>

    </ng-container>
  </ng-container>
  <ng-template #noSprintsTemplate>
    <div class="p-d-flex p-align-center p-justify-center no-sprint-msg">
      <h2 class="msg">The selected project need to have atleast one sprint available for the KPI's to show up</h2>
    </div>
  </ng-template>
  <ng-template #noProjectsTemplate>
    <div class="p-d-flex p-align-center p-justify-center no-sprint-msg">
      <h2 class="msg">Access to atleast one Scrum Project is required for the Iteration dashboard to be enabled</h2>
    </div>
  </ng-template>
</div>

<ng-template #noKpiTemplate>
  <div class="no-kpi-template">
    <app-no-access [selectedTab]="'Iteration'" [userEnable]='enableByUser'></app-no-access>
  </div>
</ng-template>

<p-dialog [(visible)]="displayModal" [modal]="true" [draggable]="true" [resizable]="true">
  <p-header>
    <div>
      {{modalDetails['header']}}
      <div class="export-button">
        <button *ngIf="modalDetails['tableValues'].length > 0" pButton pRipple label="Save" class="p-p-2 p-mr-2"
          (click)="saveTableColumnOrder()"></button>
        <button *ngIf="modalDetails['tableValues'].length > 0" pButton pRipple label="Export"
          class="p-button-secondary p-p-2 p-mr-2" (click)="generateExcel('filtered')"></button>
        <button *ngIf="modalDetails['tableValues'].length > 0" pButton pRipple label="Export All"
          class="p-button-secondary p-p-2 p-mr-2" (click)="generateExcel('all')"></button>
      </div>
    </div>

    <div *ngIf="markerInfo?.length > 0" class="p-d-flex  p-flex-wrap">
      <span *ngFor="let marker of markerInfo" class="p-m-2 markerInfo"> <i class='fas fa-square'
          [ngStyle]="{'color': marker?.color}"></i> {{marker?.info}}</span>
    </div>
  </p-header>
  <div class="dialog-body p-mb-4">
    <p-table #table [value]="modalDetails['tableValues']" [reorderableColumns]="true" [columns]="tableHeaders"
      styleClass="p-datatable-gridlines kpi-table" loadingIcon="loading-img"
      [globalFilterFields]="modalDetails['tableHeadings']" [scrollable]="true" scrollHeight="65vh">
      <ng-template pTemplate="caption">
        <p-multiSelect [options]="tableColumns" [(ngModel)]="selectedColumns" resetFilterOnHide="true"
          selectedItemsLabel="{0} columns selected" [optionValue]="'columnName'" [optionLabel]="'columnName'"
          optionDisabled="isDefault" [style]="{minWidth: '220px', 'border':'none'}" placeholder="Choose Columns">
          <ng-template pTemplate="selectedItems">
            <p-button styleClass="p-button-outlined column-btn">Column &nbsp; <img
                src="../../../assets/img/column-triple-svgrepo-com.svg" alt="Column filter icon" /></p-button>
          </ng-template>
          <ng-template pTemplate="footer">
            <hr>
            <p-button label="Apply" class="p-mb-2 p-mr-2 columns-btn" (click)="applyColumnFilter()"></p-button>
          </ng-template>

        </p-multiSelect>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <ng-container *ngFor="let item of tableHeaders;let i = index;">
            <th [ngClass]="{'overlap': filteredColumn === item }" pReorderableColumn
              [pReorderableColumnDisabled]="forzenColumns.includes(item.toLowerCase())" pFrozenColumn alignFrozen="left"
              [frozen]="forzenColumns.includes(item.toLowerCase())" class="min-max-width">
              <div class="table-head">
                <span [ngStyle]="{'width':'max-content','margin-right': '1rem'}">{{item}}</span>
                <div class="p-d-flex">
                  <p-columnFilter *ngIf="!excludeColumnFilter.includes(item)" [field]="item" matchMode="in"
                    [showMenu]="false" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false"
                    [showClearButton]="false" [showApplyButton]="false" [style]="{'margin-top':'2px'}">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback" #filter>
                      <p-multiSelect resetFilterOnHide="true" autofocusFilter="true" (onPanelShow)="onFilterClick(item)"
                        (onPanelHide)="onFilterBlur(item)" [options]="this.tableColumnData[item]"
                        [placeholder]="'Select '+ item" (onChange)="filter($event.value)" [optionValue]="'value'"
                        [optionLabel]="'name'" [ngModel]="tableColumnForm[item]" styleClass="column-filter">
                        <ng-template pTemplate="selectedItems">
                          <i class="pi pi-filter-icon pi-filter" style="font-size: 0.8rem"></i>
                        </ng-template>
                      </p-multiSelect>
                    </ng-template>
                  </p-columnFilter>
                  <p-sortIcon [pSortableColumn]="item" [field]="item"></p-sortIcon>
                </div>
              </div>
            </th>
          </ng-container>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-x let-columns="columns" let-index="rowIndex">
        <tr [pReorderableRow]="index">


          <ng-container *ngFor="let item of tableHeaders; let i = index;">
            <ng-container *ngIf="item == 'Issue Id'">
              <td class="font-small p-p-0 text-center min-max-width" pFrozenColumn>
                <div class="cell-indicator">
                  <div class="color-indicator" [ngStyle]="{'background-color': x['marker'] ? x['marker'] : ''}"></div>
                  <a [href]="x['Issue URL']" class="text-blue p-ml-1" target="_blank">{{x['Issue Id']}}</a>
                </div>
              </td>
            </ng-container>
            <ng-container *ngIf="item !== 'Issue Id'">
              <td *ngIf="item && typeOf(x[item]); else elseBlock" class="font-small min-max-width multidata-col"
                pFrozenColumn [frozen]="forzenColumns.includes(item.toLowerCase())">
                <ng-container *ngFor="let k of x[item]|keyvalue">
                  <a [href]="k.value" class="p-d-block text-blue" target="_blank"
                    *ngIf="k.value.includes('http'); else showText">{{k.key}}</a>
                  <ng-template #showText><span>{{k.value}}</span></ng-template>
                </ng-container>
              </td>
              <ng-template #elseBlock>
                <td pFrozenColumn [frozen]="forzenColumns.includes(item.toLowerCase())" class="min-max-width">
                  {{x[item]}}</td>
              </ng-template>
            </ng-container>

          </ng-container>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="tableHeaders.length">No data found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

</p-dialog>
<app-export-excel #exportExcel></app-export-excel>
