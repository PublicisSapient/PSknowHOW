//------------------------- 8.1.0 changes----------------------------------------------------------------------------------
db.getCollection('field_mapping_structure').insertMany([{
    "fieldName": "startDateCountKPI150",
    "fieldLabel": "Count of days from the release start date to calculate closure rate for prediction",
    "fieldType": "number",
    "section": "Issue Types Mapping",
    "tooltip": {
        "definition": "If this field is kept blank, then daily closure rate of issues is calculated based on the number of working days between today and the release start date or date when first issue was added. This configuration allows you to decide from which date the closure rate should be calculated."
    }
},
    {
        "fieldName": "thresholdValueKPI14",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI82",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI111",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI35",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI34",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI37",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI28",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI36",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
           "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI16",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI17",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI38",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI27",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
           "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI72",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI84",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI11",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI62",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI64",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI67",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI65",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI157",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI158",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI159",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI160",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    },
    {
        "fieldName": "thresholdValueKPI164",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    }
]);
db.kpi_master.insertOne({
    "kpiId": "kpi166",
    "kpiName": "Mean Time to Recover",
    "maxValue": "100",
    "kpiUnit": "Hours",
    "isDeleted": "False",
    "defaultOrder": 4,
    "kpiSource": "Jira",
    "kpiCategory": "Dora",
    "groupId": 15,
    "thresholdValue": 0,
    "kanban": false,
    "chartType": "line",
    "kpiInfo": {
        "definition": "Mean time to recover will be based on the Production incident tickets raised during a certain period of time.",
        "details": [
            {
                "type": "paragraph",
                "value": "For all the production incident tickets raised during a time period, the time between created date and closed date of the incident ticket will be calculated."
            },
            {
                "type": "paragraph",
                "value": "The average of all such tickets will be shown."
            },
            {
                "type" : "link",
                "kpiLinkDetail" : {
                    "text" : "Detailed Information at",
                    "link" : "https://psknowhow.atlassian.net/wiki/spaces/PSKNOWHOW/pages/59080705/DORA+KPIs#Mean-time-to-Recover-(MTTR)"
                }
    		}
        ],
        "maturityLevels": []
    },
    "xAxisLabel": "Weeks",
    "yAxisLabel": "Hours",
    "isPositiveTrend": false,
    "showTrend": true,
    "kpiFilter": "",
    "aggregationCriteria": "sum",
    "aggregationCircleCriteria": "average",
    "isAdditionalFilterSupport": false,
    "calculateMaturity": true,
     "maturityRange": [
          "48-",
          "24-48",
          "12-24",
          "1-12",
          "-1"
        ]

})

db.field_mapping_structure.insertMany([
    {
        "fieldName": "jiraStoryIdentificationKPI166",
        "fieldLabel": "Issue type to identify Production incidents",
        "fieldType": "chips",
        "fieldCategory": "Issue_Type",
        "section": "Issue Types Mapping",
        "tooltip": {
            "definition": "All issue types that are used as/equivalent to Production incidents.",

        }
    },
    {
        "fieldName": "jiraProductionIncidentIdentification",
        "fieldLabel": "Production incidents identification",
        "fieldType": "radiobutton",
        "section": "Defects Mapping",
        "tooltip": {
            "definition": "This field is used to identify if a production incident is raised by third party or client:<br>1. CustomField : If a separate custom field is used<br>2. Labels : If a label is used to identify. Example: PROD_DEFECT (This has to be one value).<hr>"
        },
        "options": [{
            "label": "CustomField",
            "value": "CustomField"
        },
        {
            "label": "Labels",
            "value": "Labels"
        }
        ],
        "nestedFields": [

            {
                "fieldName": "jiraProdIncidentRaisedByCustomField",
                "fieldLabel": "Production Incident Custom Field",
                "fieldType": "text",
                "fieldCategory": "fields",
                "filterGroup": ["CustomField"],
                "tooltip": {
                    "definition": "Provide customfield name to identify Production Incident. <br> Example: customfield_13907<hr>"
                }
            },
            {
                "fieldName": "jiraProdIncidentRaisedByValue",
                "fieldLabel": "Production Incident Values",
                "fieldType": "chips",
                "filterGroup": ["CustomField", "Labels"],
                "tooltip": {
                    "definition": "Provide label name to identify Production Incident Example: PROD_INCIDENT <hr>"
                }
            }
        ]
    },
    {
        "fieldName": "jiraDodKPI166",
        "fieldLabel": "DOD Status",
        "fieldType": "chips",
        "fieldCategory": "workflow",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "Status/es that identify that an issue is completed based on Definition of Done (DoD)."
        }
    }
])

db.getCollection("kpi_column_configs").insertMany([
    {
        "basicProjectConfigId": null,
        "kpiId": "kpi166",
        "kpiColumnDetails": [
            {
                "columnName": "Project Name",
                "order": 0,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Date",
                "order": 1,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Story ID",
                "order": 2,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Issue Type",
                "order": 3,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Issue Description",
                "order": 4,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Created Date",
                "order": 5,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Completion Date",
                "order": 6,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Time to Recover (In Hours)",
                "order": 7,
                "isShown": true,
                "isDefault": true
            }
        ]
    }
]);

db.getCollection('metadata_identifier').updateMany(
    { "templateCode": { $in: ["7"] } },
    {
        $push: {
            "workflow": {
                "type": "jiraDodKPI166",
                "value": [
                    "Closed"
                ]
            },
            "issues": {
                "type": "jiraStoryIdentificationKPI166",
                "value": [
                    "Story",
                    "Enabler Story",
                    "Tech Story",
                    "Change request"
                ]
            }
        }
    }
);
//------------------------------DSV S2 Changes
db.getCollection('field_mapping_structure').insertMany([
    {
        "fieldName": "jiraStatusStartDevelopmentKPI154",
        "fieldLabel": "Status to identify start of development",
        "fieldType": "chips",
        "fieldCategory": "workflow",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "Status from workflow on which issue is started development. <br> Example: In Analysis<hr>"
        }
    },
    {
        "fieldName": "jiraDevDoneStatusKPI154",
        "fieldLabel": "Status to identify Dev completed issues",
        "fieldType": "chips",
        "fieldCategory": "workflow",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "Status that confirms that the development work is completed and an issue can be passed on for testing",
        }
    },
    {
        "fieldName": "jiraQADoneStatusKPI154",
        "fieldLabel": "Status to identify QA completed issues",
        "fieldType": "chips",
        "fieldCategory": "workflow",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "Status that confirms that the QA work is completed and an issue can be ready for signoff/close",
        }
    },
    {
        "fieldName": "jiraIterationCompletionStatusKPI154",
        "fieldLabel": "Status to identify completed issues",
        "fieldType": "chips",
        "fieldCategory": "workflow",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "All statuses that signify completion for a team. (If more than one status configured, then the first status that the issue transitions to will be counted as Completion)"
        }
    },
    {
        "fieldName": "jiraStatusForInProgressKPI154",
        "fieldLabel": "Status to identify In Progress issues",
        "section": "WorkFlow Status Mapping",
        "fieldType": "chips",
        "readOnly": true,
        "tooltip": {
            "definition": "All statuses that issues have moved from the Created status and also has not been completed. <br> This field is same as the configuration field of Work Remaining KPI",
        }
    },
    {
       "fieldName": "jiraSubTaskIdentification",
       "fieldLabel": "Sub-Task Issue Types",
       "fieldType": "chips",
       "fieldCategory": "Issue_Type",
       "section": "Issue Types Mapping",
       "tooltip": {
       "definition": "Any issue type mentioned will be considered as sub-task linked with story"
       }
    },
    {
        "fieldName": "storyFirstStatusKPI154",
        "fieldLabel": "Status when 'Story' issue type is created",
        "fieldType": "chips",
        "fieldCategory": "workflow",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "All issue types that identify with a Story.",

        }
    },
    {
        "fieldName": "jiraOnHoldStatusKPI154",
        "fieldLabel": "Status when issue type is put on Hold",
        "fieldType": "chips",
        "fieldCategory": "workflow",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "All status that identify hold/blocked statuses.",

        }
    }
])
// Initialize an array to store the bulk write operations
var metaDataOperations = [];

// Add the first update operation to the bulk operations array
metaDataOperations.push({
   updateMany: {
      filter: {
         $or: [
            { "templateCode": "8" },
            { "tool": "Azure" }
         ]
      },
      update: {
         $push: {
            "workflow": {
               "type": "firstDevstatus",
               "value": [
                  "In Analysis",
                  "IN ANALYSIS",
                  "In Development",
                  "In Progress"
               ]
            }
         }
      }
   }
});

metaDataOperations.push({
   updateMany: {
      filter: {
         "templateCode": "7"
      },
      update: {
         $push: {
            "workflow": {
               "type": "jiraStatusForInProgressKPI154",
               "value": [
                  "In Analysis",
                  "In Development",
                  "In Progress"
               ]
            }
         }
      }
   }
});

db.kpi_master.bulkWrite([
    {
        updateMany: {
            filter: { "kpiId": { $in: ["kpi150"] } },
            update: { $set: { "defaultOrder": 1 } }
        },
    }
]);

db.kpi_master.updateOne(
   { "kpiId": "kpi150" },
   {
      $set: {
         "kpiInfo.details": [
            {
               "type": "link",
               "kpiLinkDetail": {
                  "text": "Detailed Information at",
                  "link": "https://psknowhow.atlassian.net/wiki/spaces/PSKNOWHOW/pages/41582601/RELEASE+Health#Release-Burnup"
               }
            }
         ]
      }
   }
)

db.getCollection("kpi_column_configs").insertMany([
    {
        "basicProjectConfigId": null,
        "kpiId": "kpi166",
        "kpiColumnDetails": [
            {
                "columnName": "Project Name",
                "order": 0,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Date",
                "order": 1,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Story ID",
                "order": 2,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Issue Type",
                "order": 3,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Issue Description",
                "order": 4,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Created Date",
                "order": 5,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Completion Date",
                "order": 6,
                "isShown": true,
                "isDefault": true
            },
            {
                "columnName": "Time to Recover (In Hours)",
                "order": 7,
                "isShown": true,
                "isDefault": true
            }
        ]
    }
]);

db.getCollection('metadata_identifier').updateMany(
    { "templateCode": { $in: ["7"] } },
    {
        $push: {
            "workflow": {
                "type": "jiraDodKPI166",
                "value": [
                    "Closed"
                ]
            },
            "issues": {
                "type": "jiraStoryIdentificationKPI166",
                "value": [
                    "Story",
                    "Enabler Story",
                    "Tech Story",
                    "Change request"
                ]
            }
        }
    }
);

metaDataOperations.push({
   updateMany: {
      filter: {
         "templateCode": "7"
      },
      update: {
         $push: {
            "workflow": {
               "type": "jiraStatusStartDevelopmentKPI154",
               "value": [
                  "In Analysis",
                  "IN ANALYSIS",
                  "In Development",
                  "In Progress"
               ]
            }
         }
      }
   }
});

metaDataOperations.push({
   updateMany: {
      filter: {
         "templateCode": "7"
      },
      update: {
         $push: {
            "workflow":{
                      "type": "storyFirstStatusKPI154",
                      "value": [
                          "Open"
                      ]
                  }
         }
      }
   }
});

// Execute the bulk write operations
db.getCollection('metadata_identifier').bulkWrite(metaDataOperations);

//-------------Sonar Code Quality---------
db.getCollection('kpi_master').insertOne(
{
    "kpiId": "kpi168",
    "kpiName": "Sonar Code Quality",
    "kpiUnit": "unit",
    "maxValue": "90",
    "isDeleted": "False",
    "defaultOrder": 14,
    "kpiSource": "Sonar",
    "groupId": 1,
    "kanban": false,
    "chartType": "bar-with-y-axis-group",
    "kpiInfo": {
      "definition": "Sonar Code Quality is graded based on the static and dynamic code analysis procedure built in Sonarqube that analyses code from multiple perspectives.",
      "details": [
        {
          "type": "paragraph",
          "value": "Code Quality in Sonarqube is shown as Grades (A to E)."
        },
        {
          "type": "paragraph",
          "value": "A is the highest (best) and,"
        },
        {
          "type": "paragraph",
          "value": "E is the least"
        },
        {
          "type": "link",
          "kpiLinkDetail": {
            "text": "Detailed Information at",
            "link": "https://psknowhow.atlassian.net/wiki/spaces/PSKNOWHOW/pages/27197457/Scrum+QUALITY+KPIs#Sonar-Code-Quality"
          }
        }
      ]
    },
    "xAxisLabel": "Months",
    "yAxisLabel": "Code Quality",
    "isPositiveTrend": true,
    "showTrend": true,
    "kpiFilter": "dropDown",
    "aggregationCriteria": "average",
    "isAdditionalFilterSupport": false,
    "calculateMaturity": true,
    "hideOverallFilter": true,
    "maturityRange": ["5", "4", "3", "2", "1"],
    "yaxisOrder" : {
            5 : 'E',
            4 : 'D',
            3 : 'C',
            2 : 'B',
            1 : 'A'
        }
  }
);

// Note : below code only For Opensource project
// Sonar Code Quality KPI category mapping
db.getCollection('kpi_category_mapping').insertOne( {       "kpiId": "kpi168",
                                                    		"categoryId": "categoryTwo",
                                                    		"kpiOrder": 15,
                                                    		"kanban": false
                                                    	});

db.kpi_master.updateOne({ "kpiId": "kpi169" }, { $set: { "kpiFilter": "radioButton" } })
db.kpi_master.updateMany(
   { "kpiId" : { $in: ["kpi151", "kpi152","kpi155"] } },
   { $unset: { kpiFilter: 1 } }
);


// DTS-27379: add flow efficiency KPI
db.getCollection("kpi_master").insertOne({
    "kpiId": "kpi170",
    "kpiName": "Flow Efficiency",
    "kpiUnit": "%",
    "isDeleted": "False",
    "defaultOrder": 1,
    "kpiCategory": "Backlog",
    "kpiSource": "Jira",
    "groupId": 11,
    "thresholdValue": "",
    "kanban": false,
    "chartType": "line",
    "kpiInfo": {
        "definition": "The percentage of time spent in work states vs wait states across the lifecycle of an issue"
    },
    "xAxisLabel": "Duration",
    "yAxisLabel": "Percentage",
    "isPositiveTrend": false,
    "kpiFilter": "dropDown",
    "showTrend": false,
    "aggregationCriteria": "average",
    "isAdditionalFilterSupport": false,
    "calculateMaturity": false,
    "kpiSubCategory": "Flow KPIs"
});

// DTS-29379 add flow efficiency field mappings
db.getCollection("field_mapping_structure").insertMany([
    {
        "fieldName": "jiraIssueClosedStateKPI170",
        "fieldLabel": "Status to identify Close Statuses",
        "fieldCategory": "workflow",
        "fieldType": "chips",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "All statuses that signify an issue is 'DONE' based on 'Definition Of Done'"
        }
    },
    {
        "fieldName": "jiraIssueWaitStateKPI170",
        "fieldLabel": "Status to identify Wait Statuses",
        "fieldCategory": "workflow",
        "fieldType": "chips",
        "section": "WorkFlow Status Mapping",
        "tooltip": {
            "definition": "The statuses wherein no activity takes place and signifies that the issue is in the queue"
        }
    }
])

db.kpi_master.updateOne({ "kpiId": "kpi138" }, { $set: { "defaultOrder": 1 } })
db.kpi_master.updateOne({ "kpiId": "kpi129" }, { $set: { "defaultOrder": 3 } })
db.kpi_master.updateOne({ "kpiId": "kpi137" }, { $set: { "defaultOrder": 5 } })
db.kpi_master.updateOne({ "kpiId": "kpi161" }, { $set: { "defaultOrder": 4 } })
db.kpi_master.updateOne({ "kpiId": "kpi127" }, { $set: { "defaultOrder": 2 } })
db.kpi_master.updateOne({ "kpiId": "kpi139" }, { $set: { "defaultOrder": 6 } })

// DTS-29397 update repo tools
db.getCollection("repo_tools_provider").bulkWrite([
  {
    updateOne: {
      filter: { "toolName": "bitbucket" },
      update: {
        $set: {
          "testServerApiUrl": "/bitbucket/rest/api/1.0/projects/",
          "testApiUrl": "https://api.bitbucket.org/2.0/workspaces/"
        }
      }
    }
  },
  // Update for gitlab tool
  {
    updateOne: {
      filter: { "toolName": "gitlab" },
      update: {
        $set: {
          "testApiUrl": "/api/v4/projects/"
        }
      }
    }
  }
], { ordered: false });


// Change PR size maturity
db.kpi_master.updateOne({ "kpiId": "kpi162" }, { $set: { "calculateMaturity" : false } })

db.kpi_master.updateOne(
{
    "kpiId": "kpi162"
},
{ $set: {
        "calculateMaturity": false,
        "showTrend": false
    }
}
)
db.kpi_master.updateMany(
{
    "kpiId": { $in: [
            "kpi160",
            "kpi158"
        ]
    }
},
{ $set: {
        "upperThresholdBG": "red",
        "lowerThresholdBG": "white"
    }
}
);

db.field_mapping_structure.updateOne(
    { "fieldName": "jiraDodKPI14" },
    {
        $set: {
            "fieldLabel": "Status considered for Issue closure",
            "tooltip": {
                "definition": "Status considered for issue closure (Mention completed status of all types of issues)"
            }
        }
    }
)

db.kpi_master.updateMany(
    {
        "kpiId": { $in: ["kpi152", "kpi155", "kpi151"] }
    },
    {
        $set: { "kpiSubCategory": "Backlog Overview" }
    }
);


//------------------------- 8.2.0 changes----------------------------------------------------------------------------------
db.getCollection('field_mapping_structure').insertMany([
{
	"fieldName": "populateByDevDoneKPI150",
	"fieldLabel": "Prediction logic",
	"fieldType": "toggle",
	"toggleLabelLeft" : "Overall completion",
	"toggleLabelRight": "Dev Completion",
	"section": "WorkFlow Status Mapping",
	"processorCommon": false,
	"tooltip": {
		"definition": "Enabled State (Kpi will populate w.r.t Dev complete date)"
	}
},
{
    "fieldName": "jiraDevDoneStatusKPI150",
    "fieldLabel": "Status to identify Dev completed issues",
    "fieldType": "chips",
    "fieldCategory": "workflow",
    "section": "WorkFlow Status Mapping",
    "tooltip": {
        "definition": "Status that confirms that the development work is completed and an issue can be passed on for testing",
    }
}
]);

db.getCollection("kpi_master").updateOne(
    { "kpiId": "kpi150" },
    {
        $set: {
            "kpiInfo.definition": "It shows the cumulative daily actual progress of the release against the overall scope. It also shows additionally the scope added or removed during the release w.r.t Dev/Qa completion date and Dev/Qa completion status for the Release tagged issues.",
        }
    }
);

db.field_mapping_structure.find(
    { "fieldName" : "uploadDataKPI42" },
    { $rename: { "toggleLabel": "toggleLabelRight" } }
);

db.field_mapping_structure.find(
    { "fieldName" : "uploadDataKPI16" },
    { $rename: { "toggleLabel": "toggleLabelRight" } }
);


//DTS-29689 FTPR Iteration kpi labels
db.field_mapping_structure.insertOne({
    "fieldName" : "jiraLabelsKPI135",
    "fieldLabel" : "Labels to identify issues to be included",
    "fieldType" : "chips",
    "section" : "WorkFlow Status Mapping",
    "tooltip" : {
      "definition" : "Calculation should only those issues which have defined labels tagged."
    }
});

db.kpi_master.updateOne(
  { "kpiId": "kpi3" },
  {
    $set: {
      "thresholdValue": "20",
      "kpiUnit": "Days",
      "chartType": "line",
      "kpiInfo.definition": "Lead Time is the time from the moment when the request was made by a client and placed on a board to when all work on this item is completed and the request was delivered to the client",
      "kpiInfo.formula":null,
      "boxType":null,
      "kpiWidth":null,
      "showTrend":true,
      "kpiInfo.details": [
        {
          "type": "link",
          "kpiLinkDetail": {
            "text": "Detailed Information at",
            "link": "https://psknowhow.atlassian.net/wiki/spaces/PSKNOWHOW/pages/70811702/Lead+time"
          }
        }
      ],
       "kpiFilter": "dropdown",
      "aggregationCriteria": "sum",
      "yAxisLabel": "Days",
      "xAxisLabel": "Range",
      "lowerThresholdBG": "white",
      "upperThresholdBG": "red",
      "maturityRange": [
        "-60",
        "60-45",
        "45-30",
        "30-10",
        "10-"
      ]
    }
  }
)

db.getCollection('field_mapping_structure').insertMany([{
        "fieldName": "thresholdValueKPI3",
        "fieldLabel": "Target KPI Value",
        "fieldType": "number",
        "section": "Custom Fields Mapping",
        "tooltip": {
            "definition": "Target KPI value denotes the bare minimum a project should maintain for a KPI. User should just input the number and the unit like percentage, hours will automatically be considered. If the threshold is empty, then a common target KPI line will be shown"
        }
    }
}])

db.kpi_master.insertOne(
{
      "kpiId": "kpi171",
      "kpiName": "Cycle Time",
      "maxValue": "",
      "kpiUnit": "Count",
      "isDeleted": "False",
      "defaultOrder": 4,
      "kpiCategory": "Backlog",
      "kpiSource": "Jira",
      "groupId": 11,
      "thresholdValue": "",
      "kanban": false,
      "chartType": "stackedColumn",
      "yAxisLabel": "Days",
      "xAxisLabel": "Range",
      "isAdditionalFilterSupport": false,
      "kpiFilter": "dropDown",
      "boxType": "chart",
      "calculateMaturity": false,
      "isAggregationStacks" : false ,
      "kpiInfo" : {
      "definition": "Cycle time helps ascertain time spent on each step of the complete issue lifecycle. It is being depicted in the visualization as 3 core cycles - Intake to DOR, DOR to DOD, DOD to Live.",
      "details": [
        {
          "type": "link",
          "kpiLinkDetail": {
            "text": "Detailed Information at",
            "link": "https://psknowhow.atlassian.net/wiki/spaces/PSKNOWHOW/pages/70418714/Cycle+time"
          }
        }
      ]
      },
      "kpiSubCategory": "Flow KPIs"
    }
 )

 // Update documents with "fieldName" equal to "jiraDorKPI3"
 db.field_mapping_structure.updateOne({ "fieldName": "jiraDorKPI3" }, { $set: { "fieldName": "jiraDorKPI171" } });

 // Update documents with "fieldName" equal to "jiraDodKPI3"
 db.field_mapping_structure.updateOne({ "fieldName": "jiraDodKPI3" }, { $set: { "fieldName": "jiraDodKPI171" } });

 // Update documents with "fieldName" equal to "storyFirstStatusKPI3"
 db.field_mapping_structure.updateOne({ "fieldName": "storyFirstStatusKPI3" }, { $set: { "fieldName": "storyFirstStatusKPI171" } });

 // Insert documents into the collection
 db.field_mapping_structure.insertMany([
   {
     "fieldName": "jiraLiveStatusKPI171",
     "fieldLabel": "Live Status - Cycle Time",
     "fieldCategory": "workflow",
     "fieldType": "chips",
     "section": "WorkFlow Status Mapping",
     "tooltip": {
       "definition": "Status/es that identify that an issue is LIVE in Production"
     }
   },
   {
     "fieldName": "jiraIssueTypeKPI171",
     "fieldLabel": "Issue type to be included",
     "fieldCategory": "Issue_Type",
     "fieldType": "chips",
     "section": "Issue Types Mapping",
     "tooltip": {
       "definition": "All issue types that should be included in Lead time calculation."
     }
   }
 ]);

//------------------Release 8.2.0---------------------------
db.kpi_master.updateOne(
  { "kpiId": "kpi161" },
  {
    $set: {
      "calculateMaturity": false,
      "maturityRange": ["-40", "40-60", "60-75", "75-90", "90-"]
    }
  }
);

db.kpi_master.updateOne(
  { "kpiId": "kpi116" },
  {
    $set: {
      "maturityRange": [
        "-60",
        "60-45",
        "45-30",
        "30-15",
        "15-"
      ],
      "maturityLevel": [
        {
          "level": "M5",
          "bgColor": "#167a26"
        },
        {
          "level": "M4",
          "bgColor": "#4ebb1a"
        },
        {
          "level": "M3",
          "bgColor": "#ef7643"
        },
        {
          "level": "M2",
          "bgColor": "#f53535"
        },
        {
          "level": "M1",
          "bgColor": "#c91212"
        }
      ]
    }
  }
);

db.kpi_master.updateOne(
  { "kpiId": "kpi118" },
  {
    $set: {
    "maturityRange": [
      "0-2" ,
      "2-4" ,
      "4-6" ,
      "6-8" ,
      "8-"
    ],
    "maturityLevel": [
        {
          "level": "M5",
          "bgColor": "#167a26",
		  "label": ">= 2 per week"
        },
        {
          "level": "M4",
          "bgColor": "#4ebb1a",
		  "label": "Once per week"
        },
        {
          "level": "M3",
          "bgColor": "#ef7643",
          "label": "Once in 2 weeks"
        },
        {
          "level": "M2",
          "bgColor": "#f53535",
          "label": "Once in 4 weeks"
        },
        {
          "level": "M1",
           "bgColor": "#c91212",
          "label": "< Once in 8 weeks"
        }
     ]
    }
  }
);

db.kpi_master.updateOne(
  { "kpiId": "kpi156" },
  {
    $set: {
      "calculateMaturity": true,
      "maturityRange": [
        "90-",
        "30-90",
        "7-30",
        "1-7",
        "-1"
      ],
      "maturityLevel": [
        {
          "level": "M5",
          "bgColor": "#167a26",
          "label": "< 1 Day"
        },
        {
          "level": "M4",
          "bgColor": "#4ebb1a",
          "label": "< 7 Days"
        },
        {
          "level": "M3",
          "bgColor": "#ef7643",
          "label": "< 30 Days"
        },
        {
          "level": "M2",
          "bgColor": "#f53535",
          "label": "< 90 Days"
        },
        {
          "level": "M1",
          "bgColor": "#c91212",
          "label": ">= 90 Days"
        }
      ]
    },
    $unset: {
      "kpiInfo.maturityLevels": ""
    }
  }
);

db.kpi_master.updateOne(
  { "kpiId": "kpi166" },
  {
    $set: {
      "calculateMaturity": true,
      "maturityRange": [
            "48-",
            "24-48",
            "12-24",
            "1-12",
            "-1"
      ],
"maturityLevel": [
        {
          "level": "M5",
          "bgColor": "#167a26"
        },
        {
          "level": "M4",
          "bgColor": "#4ebb1a"
        },
        {
          "level": "M3",
          "bgColor": "#ef7643"
        },
        {
          "level": "M2",
          "bgColor": "#f53535"
        },
        {
          "level": "M1",
           "bgColor": "#c91212"
        }
      ]
    },
    $unset: {
      "kpiInfo.maturityLevels": ""
    }
  }
);

